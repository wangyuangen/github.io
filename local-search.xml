<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>HTTP与Socket以及WebSocket的关系与区别</title>
    <link href="/2021/03/15/20210315/"/>
    <url>/2021/03/15/20210315/</url>
    
    <content type="html"><![CDATA[<h3 id="WebSocket和Socket区别"><a href="#WebSocket和Socket区别" class="headerlink" title="WebSocket和Socket区别"></a>WebSocket和Socket区别</h3><p>可以理解WebSocket为HTTP(应用层)，而Socket是将TCP/IP传输层协议封装后供调用的接口。</p><p>HTTP协议有一个缺陷：通信只能由客户端发起，做不到服务器主动向客户端推送消息。</p><p>WebSocket协议的最大特点是服务器可主动向客户端推送消息，客户端也可以主动向服务器发送信息，是真正的双向平等<br>对话，属于服务器推送技术的一种</p><h3 id="Socket和HTTP的区别"><a href="#Socket和HTTP的区别" class="headerlink" title="Socket和HTTP的区别"></a>Socket和HTTP的区别</h3><p>HTTP协议：简单的对象访问协议，对应于应用层。HTTP协议是基于TCP链接的。</p><p>TCP协议：对应于传输层。</p><p>IP协议：对应于网络层。</p><p>TCP/IP是传输层协议，主要解决数据如何在网络中传输，而HTTP是应用层协议，主要解决如何包装数据。</p><p>Socket是对TCP/IP协议的封装，Socket本身并不是协议，而是一个调用接口(API)，通过Socket才能使用TCP/IP协议。</p><p>HTTP连接：HTTP连接为短链接，及客户端向服务器发送一次请求，服务端响应后连接即会断开。</p><p>Socket连接：Socket连接为长连接，理论上客户端和服务端一旦建立连接，则不会主动断掉;但是由于各种环境因素可能会是连接断开，比如服务器端或客户端主机宕机、网络故障，或者两者间长时间没有数据传输，网络防火墙可能会断开该连接已释放网络资源。所以当一个Socket连接中没有数据的传输，那么为了位置连续的连接需要发送心跳消息，具体心跳消息格式由开发者自己定义。</p><h4 id="1-HTTP的长连接一般就只能坚持一分钟而已，而且是浏览器决定的，你的页面很难控制这个行为。Socket连接就可以维持很久，几天、数月都有可能，只要网络不断、程序不结束，而且是可以编程灵活控制的。"><a href="#1-HTTP的长连接一般就只能坚持一分钟而已，而且是浏览器决定的，你的页面很难控制这个行为。Socket连接就可以维持很久，几天、数月都有可能，只要网络不断、程序不结束，而且是可以编程灵活控制的。" class="headerlink" title="1.HTTP的长连接一般就只能坚持一分钟而已，而且是浏览器决定的，你的页面很难控制这个行为。Socket连接就可以维持很久，几天、数月都有可能，只要网络不断、程序不结束，而且是可以编程灵活控制的。"></a>1.HTTP的长连接一般就只能坚持一分钟而已，而且是浏览器决定的，你的页面很难控制这个行为。Socket连接就可以维持很久，几天、数月都有可能，只要网络不断、程序不结束，而且是可以编程灵活控制的。</h4><h4 id="2-HTTP连接是建立在Socket连接之上。在实际的网络栈中，Socket连接的确是HTTP连接的一部分。但是从HTTP协议看，它的连接一般是指它本身的那部分。"><a href="#2-HTTP连接是建立在Socket连接之上。在实际的网络栈中，Socket连接的确是HTTP连接的一部分。但是从HTTP协议看，它的连接一般是指它本身的那部分。" class="headerlink" title="2.HTTP连接是建立在Socket连接之上。在实际的网络栈中，Socket连接的确是HTTP连接的一部分。但是从HTTP协议看，它的连接一般是指它本身的那部分。"></a>2.HTTP连接是建立在Socket连接之上。在实际的网络栈中，Socket连接的确是HTTP连接的一部分。但是从HTTP协议看，它的连接一般是指它本身的那部分。</h4><p>TCP/IP协议栈主要分为四层:应用层、传输层、网络层、数据链路层，每层都有相应的协议，如下图<br><img src="/15/20210315/TCP%E5%8D%8F%E8%AE%AE%E5%B1%82%E6%AC%A1.jpeg" srcset="/img/loading.gif" alt="TCP协议层次"></p><h4 id="IP："><a href="#IP：" class="headerlink" title="IP："></a>IP：</h4><p>网络层协议；（高速公路）</p><h4 id="TCP和UDP："><a href="#TCP和UDP：" class="headerlink" title="TCP和UDP："></a>TCP和UDP：</h4><p>传输层协议；（卡车）</p><h4 id="HTTP："><a href="#HTTP：" class="headerlink" title="HTTP："></a>HTTP：</h4><p>应用层协议；（货物）。HTTP(超文本传输协议)是利用TCP在两台电脑(通常是Web服务器和客户端)之间传输信息的协议。客户端使用Web浏览器发起HTTP请求给Web服务器，Web服务器发送被请求的信息给客户端<br>http为短连接：客户端发送请求都需要服务器端回送响应.请求结束后，主动释放链接，因此为短连接。通常的做法是，不需要任何数据，也要保持每隔一段时间向服务器发送”保持连接”的请求。这样可以保证客户端在服务器端是”上线”状态。</p><p>HTTP连接使用的是”请求-响应”方式，不仅在请求时建立连接，而且客户端向服务器端请求后，服务器才返回数据。</p><h4 id="Socket："><a href="#Socket：" class="headerlink" title="Socket："></a>Socket：</h4><p>套接字，TCP/IP网络的API。(港口码头/车站)Socket是应用层与TCP/IP协议族通信的中间软件抽象层，它是一组接口。socket是在应用层和传输层之间的一个抽象层，它把TCP/IP层复杂的操作抽象为几个简单的接口供应用层调用已实现进程在网络中通信。</p><h5 id="Socket链接"><a href="#Socket链接" class="headerlink" title="Socket链接:"></a>Socket链接:</h5><p>要想明白 Socket，必须要理解 TCP 连接。<br>TCP 三次握手：握手过程中并不传输数据，在握手后服务器与客户端才开始传输数据，理想状态下，TCP 连接一旦建立，在通讯双方中的任何一方主动断开连接之前 TCP 连接会一直保持下去。<br>Socket 是对 TCP/IP 协议的封装，Socket 只是个接口不是协议，通过 Socket 我们才能使用 TCP/IP 协议，除了 TCP，也可以使用 UDP 协议来传递数据。<br>创建 Socket 连接的时候，可以指定传输层协议，可以是 TCP 或者 UDP，当用 TCP 连接，该Socket就是个TCP连接，反之。<br>Socket为长连接：通常情况下Socket 连接就是 TCP 连接，因此 Socket 连接一旦建立,通讯双方开始互发数据内容，直到双方断开连接。在实际应用中，由于网络节点过多，在传输过程中，会被节点断开连接，因此要通过轮询高速网络，该节点处于活跃状态。</p><h5 id="Socket原理"><a href="#Socket原理" class="headerlink" title="Socket原理"></a>Socket原理</h5><p>Socket 连接,至少需要一对套接字，分为 clientSocket，serverSocket 连接分为3个步骤:<br>(1) 服务器监听:服务器并不定位具体客户端的套接字，而是时刻处于监听状态；<br>(2) 客户端请求:客户端的套接字要描述它要连接的服务器的套接字，提供地址和端口号，然后向服务器套接字提出连接请求；<br>(3) 连接确认:当服务器套接字收到客户端套接字发来的请求后，就响应客户端套接字的请求,并建立一个新的线程,把服务器端的套接字的描述发给客户端。一旦客户端确认了此描述，就正式建立连接。而服务器套接字继续处于监听状态，继续接收其他客户端套接字的连接请求.</p><h4 id="TCP-IP："><a href="#TCP-IP：" class="headerlink" title="TCP/IP："></a>TCP/IP：</h4><p>代表传输控制协议/网际协议，指的是一系列协议，TCP/IP 模型在 OSI 模型的基础上进行了简化，变成了四层，从下到上分别为：网络接口层、网络层、传输层、应用层。与 OSI 体系结构对比如下：<br><img src="/15/20210315/TCP%E5%8D%8F%E8%AE%AE%E5%B1%82%E6%AC%A12.jpeg" srcset="/img/loading.gif" alt="TCP协议层次2"></p><h3 id="TCP-UDP区别："><a href="#TCP-UDP区别：" class="headerlink" title="TCP/UDP区别："></a>TCP/UDP区别：</h3><h4 id="TCP"><a href="#TCP" class="headerlink" title="TCP"></a>TCP</h4><p>（传输控制协议，Transmission Control Protocol）：(类似打电话)<br>面向连接、传输可靠（保证数据正确性）、有序（保证数据顺序）、传输大量数据（流模式）、速度慢、对系统资源的要求多，程序结构较复杂，每一条TCP连接只能是点到点的，<br>TCP首部开销20字节。</p><h4 id="UDP"><a href="#UDP" class="headerlink" title="UDP"></a>UDP</h4><p>(用户数据报协议，User Data Protocol)：（类似发短信）<br>面向非连接 、传输不可靠（可能丢包）、无序、传输少量数据（数据报模式）、速度快，对系统资源的要求少，程序结构较简单,UDP支持一对一，一对多，多对一和多对多的交互通信，<br>UDP的首部开销小，只有8个字节。</p><h4 id="tcp三次握手建立连接："><a href="#tcp三次握手建立连接：" class="headerlink" title="tcp三次握手建立连接："></a>tcp三次握手建立连接：</h4><p>第一次握手：客户端发送syn包(seq=x)到服务器，并进入SYN_SEND状态，等待服务器确认；</p><p>第二次握手：服务器收到syn包，必须确认客户的SYN（ack=x+1），同时自己也发送一个SYN包（seq=y），即SYN+ACK包，此时服务器进入SYN_RECV状态；</p><p>第三次握手：客户端收到服务器的SYN＋ACK包，向服务器发送确认包ACK(ack=y+1)，此包发送完毕，客户端和服务器进入ESTABLISHED状态，完成三次握手</p><p>握手过程中传送的包里不包含数据，三次握手完毕后，客户端与服务器才正式开始传送数据。理想状态下，TCP连接一旦建立，在通信双方中的任何一方主动关闭连接之前，TCP 连接都将被一直保持下去。<br>主机A向主机B发出连接请求数据包：“我想给你发数据，可以吗？”，这是第一次对话；<br>主机B向主机A发送同意连接和要求同步（同步就是两台主机一个在发送，一个在接收，协调工作）的数据包：“可以，你什么时候发？”，这是第二次对话；<br>主机A再发出一个数据包确认主机B的要求同步：“我现在就发，你接着吧！”，这是第三次对话。<br>三次“对话”的目的是使数据包的发送和接收同步，经过三次“对话”之后，主机A才向主机B正式发送数据。</p><h3 id="Websocket"><a href="#Websocket" class="headerlink" title="Websocket"></a>Websocket</h3><p>Websocket协议解决了服务器与客户端全双工通信的问题。<br>注:什么是单工、半双工、全工通信？<br>信息只能单向传送为单工；<br>信息能双向传送但不能同时双向传送称为半双工；<br>信息能够同时双向传送则称为全双工。<br>Websocket协议包含两部分:一部分是“握手”，一部分是“数据传输”</p><p>要弄明白http和socket首先要熟悉网络七层：物 数 网 传 会 表 应，如图：<br><img src="/15/20210315/%E7%BD%91%E7%BB%9C%E4%B8%83%E5%B1%82.jpg" srcset="/img/loading.gif" alt="网络七层"></p><p>HTTP 协议:超文本传输协议，对应于应用层，用于如何封装数据.</p><p>TCP/UDP 协议:传输控制协议，对应于传输层，主要解决数据在网络中的传输。</p><p>IP 协议:对应于网络层，同样解决数据在网络中的传输。</p><p>传输数据的时候只使用 TCP/IP 协议(传输层)，如果没有应用层来识别数据内容，传输后的协议都是无用的。</p><p>应用层协议很多 FTP,HTTP,TELNET等，可以自己定义应用层协议。</p><p>web 使用 HTTP 作传输层协议，以封装 HTTP 文本信息，然后使用 TCP/IP 做传输层协议，将数据发送到网络上。</p>]]></content>
    
    
    <categories>
      
      <category>HTTP</category>
      
      <category>Socket</category>
      
      <category>TCP</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Socket</tag>
      
      <tag>HTTP</tag>
      
      <tag>WebSocket</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Hello World</title>
    <link href="/2021/03/15/hello-world/"/>
    <url>/2021/03/15/hello-world/</url>
    
    <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="noopener">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="noopener">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="noopener">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><div class="hljs"><pre><code class="hljs bash">$ hexo new <span class="hljs-string">"My New Post"</span></code></pre></div><p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="noopener">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><div class="hljs"><pre><code class="hljs bash">$ hexo server</code></pre></div><p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="noopener">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><div class="hljs"><pre><code class="hljs bash">$ hexo generate</code></pre></div><p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="noopener">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><div class="hljs"><pre><code class="hljs bash">$ hexo deploy</code></pre></div><p>More info: <a href="https://hexo.io/docs/one-command-deployment.html" target="_blank" rel="noopener">Deployment</a></p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>Socket通信功能实现</title>
    <link href="/2021/03/14/20210314/"/>
    <url>/2021/03/14/20210314/</url>
    
    <content type="html"><![CDATA[<h3 id="Socket概述"><a href="#Socket概述" class="headerlink" title="Socket概述"></a>Socket概述</h3><p>什么是Socket？</p><p>Socket的中文翻译过来就是“套接字”。套接字是什么，我们先来看看它的英文含义：插座。</p><p>Socket就像一个电话插座，负责连通两端的电话，进行点对点通信，让电话可以进行通信，端口就像插座上的孔，端口不能同时被其他进程占用。而我们建立连接就像把插头插在这个插座上，创建一个Socket实例开始监听后，这个电话插座就时刻监听着消息的传入，谁拨通我这个“IP地址和端口”，我就接通谁。</p><p>实际上，Socket是在应用层和传输层之间的一个抽象层，它把TCP/IP层复杂的操作抽象为几个简单的接口，供应用层调用实现进程在网络中的通信。Socket起源于UNIX，在Unix一切皆文件的思想下，进程间通信就被冠名为文件描述符（file desciptor），Socket是一种“打开—读/写—关闭”模式的实现，服务器和客户端各自维护一个“文件”，在建立连接打开后，可以向文件写入内容供对方读取或者读取对方内容，通讯结束时关闭文件</p><h3 id="服务端代码实现"><a href="#服务端代码实现" class="headerlink" title="服务端代码实现"></a>服务端代码实现</h3><p>服务端实现思路主要分创建监听对象等待客户端传入的连接,客户端连接成功后创建负责通信的socket,由负责通信的socket接受客户端发送的数据以及向客户端发送数据。</p><h4 id="创建监听"><a href="#创建监听" class="headerlink" title="创建监听"></a>创建监听</h4><div class="hljs"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Socket socketListen;<span class="hljs-comment">//监听对象</span><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> List&lt;Socket&gt; socketSends = <span class="hljs-keyword">new</span> List&lt;Socket&gt;();<span class="hljs-comment">//存储客户端连接</span><span class="hljs-comment">/// &lt;summary&gt;</span><span class="hljs-comment">/// 消息提醒</span><span class="hljs-comment">/// &lt;/summary&gt;</span><span class="hljs-comment">/// &lt;param name="msg"&gt;&lt;/param&gt;</span><span class="hljs-comment">/// &lt;param name="endpoint"&gt;&lt;/param&gt;</span><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">showMsg</span><span class="hljs-params">(string msg, EndPoint endpoint = <span class="hljs-keyword">null</span>)</span></span><span class="hljs-function"></span>&#123;    <span class="hljs-keyword">if</span> (endpoint != <span class="hljs-keyword">null</span>)        msg = string.Format(<span class="hljs-string">"&#123;0&#125;：&#123;1&#125;"</span>, endpoint.ToString(), msg);    <span class="hljs-comment">//输出msg</span>&#125;<span class="hljs-comment">/// &lt;summary&gt;</span><span class="hljs-comment">/// 监听</span><span class="hljs-comment">/// &lt;/summary&gt;</span><span class="hljs-comment">/// &lt;param name="ipStr"&gt;&lt;/param&gt;</span><span class="hljs-comment">/// &lt;param name="portStr"&gt;&lt;/param&gt;</span><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Listen</span><span class="hljs-params">(string ipStr,string portStr)</span></span><span class="hljs-function"></span>&#123;    <span class="hljs-comment">//创建监听对象</span>    socketListen = <span class="hljs-keyword">new</span> Socket(AddressFamily.InterNetwork, SocketType.Stream, ProtocolType.Tcp);    IPAddress ip;    IPAddress.TryParse(ipStr, out ip);    IPEndPoint endPoint = <span class="hljs-keyword">new</span> IPEndPoint(ip, Convert.ToInt32(portStr));    <span class="hljs-comment">//监听</span>    socketListen.Bind(endPoint);    showMsg(<span class="hljs-string">"监听成功"</span>);    socketListen.Listen(<span class="hljs-number">10</span>);    AcceptAsync();&#125;</code></pre></div><h4 id="接受客户端连接"><a href="#接受客户端连接" class="headerlink" title="接受客户端连接"></a>接受客户端连接</h4><div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">/// &lt;summary&gt;</span><span class="hljs-comment">/// 接受客户端连接</span><span class="hljs-comment">/// &lt;/summary&gt;</span><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">AcceptAsync</span><span class="hljs-params">()</span></span><span class="hljs-function"></span>&#123;    Socket socketConnect = <span class="hljs-keyword">null</span>;    socketListen.BeginAccept(async =&gt;    &#123;        socketConnect = socketListen.EndAccept(async);        string remoteEndPoint = socketConnect.RemoteEndPoint.ToString();        <span class="hljs-keyword">if</span> (!socketSends.Any(x =&gt; x.RemoteEndPoint.ToString() == remoteEndPoint))            socketSends.Add(socketConnect);        showMsg(<span class="hljs-string">"连接成功"</span>,socketConnect.RemoteEndPoint);        ReceiveAsync(socketConnect);    <span class="hljs-comment">//接受客户端数据</span>        AcceptAsync();  <span class="hljs-comment">//回调以持续接受客户端连接</span>    &#125;, <span class="hljs-keyword">null</span>);&#125;</code></pre></div><h4 id="接受客户端发送的数据"><a href="#接受客户端发送的数据" class="headerlink" title="接受客户端发送的数据"></a>接受客户端发送的数据</h4><div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">/// &lt;summary&gt;</span><span class="hljs-comment">/// 接受客户端数据</span><span class="hljs-comment">/// &lt;/summary&gt;</span><span class="hljs-comment">/// &lt;param name="socket"&gt;&lt;/param&gt;</span><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">ReceiveAsync</span><span class="hljs-params">(Socket socket)</span></span><span class="hljs-function"></span>&#123;    <span class="hljs-keyword">byte</span>[] data = <span class="hljs-keyword">new</span> <span class="hljs-keyword">byte</span>[<span class="hljs-number">1024</span>];    socket.BeginReceive(data, <span class="hljs-number">0</span>, data.Length, SocketFlags.None, async =&gt;    &#123;        <span class="hljs-keyword">try</span>        &#123;            <span class="hljs-keyword">int</span> lenght = socket.EndReceive(async);            string result = Encoding.UTF8.GetString(data, <span class="hljs-number">0</span>, lenght);            showMsg(result,socket.RemoteEndPoint);            ReceiveAsync(socket);        &#125;        <span class="hljs-keyword">catch</span> (SocketException ex)        &#123;            showMsg(ex.Message);        &#125;    &#125;, <span class="hljs-keyword">null</span>);&#125;</code></pre></div><h4 id="向客户端发送数据"><a href="#向客户端发送数据" class="headerlink" title="向客户端发送数据"></a>向客户端发送数据</h4><div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">/// &lt;summary&gt;</span><span class="hljs-comment">/// 向客户端发送数据</span><span class="hljs-comment">/// &lt;/summary&gt;</span><span class="hljs-comment">/// &lt;param name="remoteEndPoint"&gt;&lt;/param&gt;</span><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Send</span><span class="hljs-params">(string msg,string remoteEndPoint)</span></span><span class="hljs-function"></span>&#123;    <span class="hljs-keyword">byte</span>[] buffer = Encoding.UTF8.GetBytes(msg);    Socket sendSocket = socketSends.FirstOrDefault(x =&gt; x.RemoteEndPoint.ToString() == remoteEndPoint);     <span class="hljs-keyword">if</span> (sendSocket != <span class="hljs-keyword">null</span>)    &#123;        sendSocket.BeginSend(buffer, <span class="hljs-number">0</span>, buffer.Length, SocketFlags.None, async =&gt;        &#123;            sendSocket.EndSend(async);            showMsg(msg, sendSocket.LocalEndPoint);        &#125;, <span class="hljs-keyword">null</span>);    &#125;&#125;</code></pre></div><h3 id="客户端代码实现"><a href="#客户端代码实现" class="headerlink" title="客户端代码实现"></a>客户端代码实现</h3><p>客户端负责向服务端发送连接请求,连接成功后与服务端之间收发数据的功能</p><h4 id="创建连接"><a href="#创建连接" class="headerlink" title="创建连接"></a>创建连接</h4><div class="hljs"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Socket socketClient;<span class="hljs-comment">/// &lt;summary&gt;</span><span class="hljs-comment">/// 消息提醒</span><span class="hljs-comment">/// &lt;/summary&gt;</span><span class="hljs-comment">/// &lt;param name="msg"&gt;&lt;/param&gt;</span><span class="hljs-comment">/// &lt;param name="endpoint"&gt;&lt;/param&gt;</span><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">ShowMsg</span><span class="hljs-params">(string msg, EndPoint endpoint = <span class="hljs-keyword">null</span>)</span></span><span class="hljs-function"></span>&#123;    <span class="hljs-keyword">if</span> (endpoint != <span class="hljs-keyword">null</span>)        msg = string.Format(<span class="hljs-string">"&#123;0&#125;：&#123;1&#125;"</span>, endpoint.ToString(), msg);    <span class="hljs-comment">//输出msg</span>&#125;<span class="hljs-comment">/// &lt;summary&gt;</span><span class="hljs-comment">/// 连接</span><span class="hljs-comment">/// &lt;/summary&gt;</span><span class="hljs-comment">/// &lt;param name="ip"&gt;&lt;/param&gt;</span><span class="hljs-comment">/// &lt;param name="port"&gt;&lt;/param&gt;</span><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">ConnectAsync</span><span class="hljs-params">(string ip,string port)</span></span><span class="hljs-function"></span>&#123;    socketClient = <span class="hljs-keyword">new</span> Socket(AddressFamily.InterNetwork, SocketType.Stream, ProtocolType.Tcp);    IPAddress address;    IPAddress.TryParse(ip, out address);    IPEndPoint endPoint = <span class="hljs-keyword">new</span> IPEndPoint(address, Convert.ToInt32(port));    socketClient.BeginConnect(endPoint, async =&gt;    &#123;        socketClient.EndConnect(async);        ShowMsg(<span class="hljs-string">"连接成功"</span>);        ReceiveAsync(socketClient);    &#125;, <span class="hljs-keyword">null</span>);&#125;</code></pre></div><h4 id="接受数据"><a href="#接受数据" class="headerlink" title="接受数据"></a>接受数据</h4><div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">/// &lt;summary&gt;</span><span class="hljs-comment">/// 接受数据</span><span class="hljs-comment">/// &lt;/summary&gt;</span><span class="hljs-comment">/// &lt;param name="socketClient"&gt;&lt;/param&gt;</span><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">ReceiveAsync</span><span class="hljs-params">(Socket socketClient)</span></span><span class="hljs-function"></span>&#123;    <span class="hljs-keyword">byte</span>[] data = <span class="hljs-keyword">new</span> <span class="hljs-keyword">byte</span>[<span class="hljs-number">1024</span>];    socketClient.BeginReceive(data, <span class="hljs-number">0</span>, data.Length, SocketFlags.None, async =&gt; &#123;        socketClient.EndReceive(async);        string msg = Encoding.UTF8.GetString(data);        ShowMsg(msg, socketClient.RemoteEndPoint);        ReceiveAsync(socketClient);    &#125;, <span class="hljs-keyword">null</span>);&#125;</code></pre></div><h4 id="发送数据"><a href="#发送数据" class="headerlink" title="发送数据"></a>发送数据</h4><div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">/// &lt;summary&gt;</span><span class="hljs-comment">/// 发送数据</span><span class="hljs-comment">/// &lt;/summary&gt;</span><span class="hljs-comment">/// &lt;param name="msg"&gt;&lt;/param&gt;</span><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Send</span><span class="hljs-params">(string msg)</span></span><span class="hljs-function"></span>&#123;    <span class="hljs-keyword">byte</span>[] data = Encoding.UTF8.GetBytes(msg);    socketClient.BeginSend(data, <span class="hljs-number">0</span>, data.Length, SocketFlags.None, async =&gt;    &#123;        socketClient.EndSend(async);        ShowMsg(msg, socketClient.LocalEndPoint);    &#125;, <span class="hljs-keyword">null</span>);&#125;</code></pre></div>]]></content>
    
    
    <categories>
      
      <category>C#</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Socket</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>浅拷贝与深拷贝</title>
    <link href="/2020/10/15/20201015/"/>
    <url>/2020/10/15/20201015/</url>
    
    <content type="html"><![CDATA[<h3 id="浅拷贝"><a href="#浅拷贝" class="headerlink" title="浅拷贝"></a>浅拷贝</h3><h5 id="值类型"><a href="#值类型" class="headerlink" title="值类型"></a><a href="https://docs.microsoft.com/zh-cn/dotnet/csharp/language-reference/builtin-types/value-types" target="_blank" rel="noopener">值类型</a></h5><h5 id="值类型的拷贝是将源拷贝对象的值赋予被拷贝对象，在修改被拷贝对象的值之后并不会影响源拷贝对象的值"><a href="#值类型的拷贝是将源拷贝对象的值赋予被拷贝对象，在修改被拷贝对象的值之后并不会影响源拷贝对象的值" class="headerlink" title="值类型的拷贝是将源拷贝对象的值赋予被拷贝对象，在修改被拷贝对象的值之后并不会影响源拷贝对象的值"></a>值类型的拷贝是将源拷贝对象的值赋予被拷贝对象，在修改被拷贝对象的值之后并不会影响源拷贝对象的值</h5><div class="hljs"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Main</span><span class="hljs-params">(string[] args)</span></span><span class="hljs-function"></span>&#123;    <span class="hljs-comment">//值类型拷贝</span>    <span class="hljs-keyword">int</span> a = <span class="hljs-number">5</span>, b = a;    b = <span class="hljs-number">6</span>;    Console.WriteLine($<span class="hljs-string">"a:&#123;a&#125;"</span>);    Console.WriteLine($<span class="hljs-string">"b:&#123;b&#125;"</span>);&#125;</code></pre></div><p>控制台输出结果:</p><div class="hljs"><pre><code class="hljs bash">a:5b:6</code></pre></div><h5 id="引用类型"><a href="#引用类型" class="headerlink" title="引用类型"></a><a href="https://docs.microsoft.com/zh-cn/dotnet/csharp/language-reference/keywords/reference-types" target="_blank" rel="noopener">引用类型</a></h5><h5 id="引用类型的拷贝只是复制源拷贝对象的引用地址给被拷贝对象，两者的引用地址都指向托管堆上的同一处对象实例，因此在修改被拷贝对象后源拷贝对象也会被修改"><a href="#引用类型的拷贝只是复制源拷贝对象的引用地址给被拷贝对象，两者的引用地址都指向托管堆上的同一处对象实例，因此在修改被拷贝对象后源拷贝对象也会被修改" class="headerlink" title="引用类型的拷贝只是复制源拷贝对象的引用地址给被拷贝对象，两者的引用地址都指向托管堆上的同一处对象实例，因此在修改被拷贝对象后源拷贝对象也会被修改"></a>引用类型的拷贝只是复制源拷贝对象的引用地址给被拷贝对象，两者的引用地址都指向托管堆上的同一处对象实例，因此在修改被拷贝对象后源拷贝对象也会被修改</h5><div class="hljs"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Main</span><span class="hljs-params">(string[] args)</span></span><span class="hljs-function"></span>&#123;    Student A = <span class="hljs-keyword">new</span> Student(<span class="hljs-string">"张三"</span>, <span class="hljs-string">"男"</span>);    Student B = <span class="hljs-keyword">new</span> Student();    B = A;    Console.WriteLine($<span class="hljs-string">"A:&#123;A.ToString()&#125;"</span>);    Console.WriteLine($<span class="hljs-string">"B:&#123;B.ToString()&#125;"</span>);    B.Name = <span class="hljs-string">"李四"</span>;    B.Gender = <span class="hljs-string">"女"</span>;    Console.WriteLine($<span class="hljs-string">"A:&#123;A.ToString()&#125;"</span>);    Console.WriteLine($<span class="hljs-string">"B:&#123;B.ToString()&#125;"</span>);    Console.ReadKey();&#125;<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Student</span></span><span class="hljs-class"></span>&#123;<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Student</span><span class="hljs-params">()</span> </span>&#123; &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Student</span><span class="hljs-params">(string name,string gender)</span></span><span class="hljs-function">    </span>&#123;        <span class="hljs-keyword">this</span>.Name = name;        <span class="hljs-keyword">this</span>.Gender = gender;    &#125;    <span class="hljs-keyword">private</span> string _name;    <span class="hljs-keyword">public</span> string Name    &#123;        get &#123; <span class="hljs-keyword">return</span> _name; &#125;        set &#123; _name = value; &#125;    &#125;    <span class="hljs-keyword">private</span> string _gender;    <span class="hljs-keyword">public</span> string Gender    &#123;        get &#123; <span class="hljs-keyword">return</span> _gender; &#125;        set &#123; _gender = value; &#125;    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> override string <span class="hljs-title">ToString</span><span class="hljs-params">()</span></span><span class="hljs-function">    </span>&#123;        <span class="hljs-keyword">return</span> $<span class="hljs-string">"Name:&#123;Name&#125;,Gender:&#123;Gender&#125;"</span>;    &#125;&#125;</code></pre></div><p>控制台输出结果:</p><div class="hljs"><pre><code class="hljs bash">A:Name:张三,Gender:男B:Name:张三,Gender:男A:Name:李四,Gender:女B:Name:李四,Gender:女</code></pre></div><h5 id="浅拷贝亦可继承自接口ICloneable通过MemberwiseClone方法实现接口的Clone成员"><a href="#浅拷贝亦可继承自接口ICloneable通过MemberwiseClone方法实现接口的Clone成员" class="headerlink" title="浅拷贝亦可继承自接口ICloneable通过MemberwiseClone方法实现接口的Clone成员"></a>浅拷贝亦可继承自接口ICloneable通过MemberwiseClone方法实现接口的Clone成员</h5><div class="hljs"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Main</span><span class="hljs-params">(string[] args)</span></span><span class="hljs-function"></span>&#123;    Student A = <span class="hljs-keyword">new</span> Student(<span class="hljs-string">"张三"</span>, <span class="hljs-string">"男"</span>);    Student B = (Student)A.Clone();    Console.WriteLine($<span class="hljs-string">"A:&#123;A.ToString()&#125;"</span>);    Console.WriteLine($<span class="hljs-string">"B:&#123;B.ToString()&#125;"</span>);    Console.ReadKey();&#125;public class Student:ICloneable&#123;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Student</span><span class="hljs-params">()</span> </span>&#123; &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Student</span><span class="hljs-params">(string name,string gender)</span></span><span class="hljs-function">    </span>&#123;        <span class="hljs-keyword">this</span>.Name = name;        <span class="hljs-keyword">this</span>.Gender = gender;    &#125;    <span class="hljs-keyword">private</span> string _name;    <span class="hljs-keyword">public</span> string Name    &#123;        get &#123; <span class="hljs-keyword">return</span> _name; &#125;        set &#123; _name = value; &#125;    &#125;    <span class="hljs-keyword">private</span> string _gender;    <span class="hljs-keyword">public</span> string Gender    &#123;        get &#123; <span class="hljs-keyword">return</span> _gender; &#125;        set &#123; _gender = value; &#125;    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> override string <span class="hljs-title">ToString</span><span class="hljs-params">()</span></span><span class="hljs-function">    </span>&#123;        <span class="hljs-keyword">return</span> $<span class="hljs-string">"Name:&#123;Name&#125;,Gender:&#123;Gender&#125;"</span>;    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> object <span class="hljs-title">Clone</span><span class="hljs-params">()</span></span><span class="hljs-function">    </span>&#123;        <span class="hljs-comment">//创建浅表副本</span>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.MemberwiseClone();    &#125;&#125;</code></pre></div><h3 id="深拷贝"><a href="#深拷贝" class="headerlink" title="深拷贝"></a>深拷贝</h3><h5 id="通过复制对象的每个成员实现深拷贝-仍以Student为例"><a href="#通过复制对象的每个成员实现深拷贝-仍以Student为例" class="headerlink" title="通过复制对象的每个成员实现深拷贝(仍以Student为例)"></a>通过复制对象的每个成员实现深拷贝(仍以Student为例)</h5><div class="hljs"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Main</span><span class="hljs-params">(string[] args)</span></span><span class="hljs-function"></span>&#123;    Student A = <span class="hljs-keyword">new</span> Student(<span class="hljs-string">"张三"</span>, <span class="hljs-string">"男"</span>);    <span class="hljs-comment">//Student B = new Student();</span>    <span class="hljs-comment">//B.Name = A.Name;</span>    <span class="hljs-comment">//B.Gender = A.Gender;</span>    <span class="hljs-comment">//Console.WriteLine($"A:&#123;A.ToString()&#125;");</span>    <span class="hljs-comment">//Console.WriteLine($"B:&#123;B.ToString()&#125;");</span>    <span class="hljs-comment">//B.Name = "李四";</span>    <span class="hljs-comment">//B.Gender = "女";</span>    <span class="hljs-comment">//Console.WriteLine($"A:&#123;A.ToString()&#125;");</span>    <span class="hljs-comment">//Console.WriteLine($"B:&#123;B.ToString()&#125;");</span>    Student B = DeepCopyByReflection&lt;Student&gt;(A);    Console.WriteLine($<span class="hljs-string">"A:&#123;A.ToString()&#125;"</span>);    Console.WriteLine($<span class="hljs-string">"B:&#123;B.ToString()&#125;"</span>);    B.Name = <span class="hljs-string">"李四"</span>;    B.Gender = <span class="hljs-string">"女"</span>;    Console.WriteLine($<span class="hljs-string">"A:&#123;A.ToString()&#125;"</span>);    Console.WriteLine($<span class="hljs-string">"B:&#123;B.ToString()&#125;"</span>);&#125;<span class="hljs-comment">/// &lt;summary&gt;</span><span class="hljs-comment">/// 复制对象每个成员实现深拷贝</span><span class="hljs-comment">/// &lt;/summary&gt;</span><span class="hljs-comment">/// &lt;typeparam name="T"&gt;&lt;/typeparam&gt;</span><span class="hljs-comment">/// &lt;param name="obj"&gt;&lt;/param&gt;</span><span class="hljs-comment">/// &lt;returns&gt;&lt;/returns&gt;</span><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> T DeepCopyByReflection&lt;T&gt;(T obj)&#123;    <span class="hljs-keyword">if</span> (obj is string || obj.GetType().IsValueType)        <span class="hljs-keyword">return</span> obj;        object retval = Activator.CreateInstance(obj.GetType());<span class="hljs-comment">//创建对象实例</span>    FieldInfo[] fields = obj.GetType().GetFields(BindingFlags.Public | BindingFlags.NonPublic | BindingFlags.Static | BindingFlags.Instance);    foreach (<span class="hljs-keyword">var</span> field in fields)    &#123;        <span class="hljs-keyword">try</span>        &#123;            <span class="hljs-comment">//复制字段值</span>            field.SetValue(retval, DeepCopyByReflection(field.GetValue(obj)));        &#125;        <span class="hljs-keyword">catch</span> &#123; &#125;    &#125;    <span class="hljs-keyword">return</span> (T)retval;&#125;</code></pre></div><p>控制台输出结果:</p><div class="hljs"><pre><code class="hljs bash">A:Name:张三,Gender:男B:Name:张三,Gender:男A:Name:张三,Gender:男B:Name:李四,Gender:女</code></pre></div><h3 id="String类型"><a href="#String类型" class="headerlink" title="String类型"></a>String类型</h3><h5 id="到了这里产生一个疑问，String同样为引用类型，但在平时使用过程中并没有出现上述引用类型浅拷贝的问题"><a href="#到了这里产生一个疑问，String同样为引用类型，但在平时使用过程中并没有出现上述引用类型浅拷贝的问题" class="headerlink" title="到了这里产生一个疑问，String同样为引用类型，但在平时使用过程中并没有出现上述引用类型浅拷贝的问题"></a>到了这里产生一个疑问，String同样为引用类型，但在平时使用过程中并没有出现上述引用类型浅拷贝的问题</h5><div class="hljs"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Main</span><span class="hljs-params">(string[] args)</span></span><span class="hljs-function"></span>&#123;    string a = <span class="hljs-string">"123"</span>, b = a;    Console.WriteLine($<span class="hljs-string">"a:&#123;a&#125;"</span>);    Console.WriteLine($<span class="hljs-string">"b:&#123;b&#125;"</span>);    b = <span class="hljs-string">"456"</span>;    Console.WriteLine($<span class="hljs-string">"a:&#123;a&#125;"</span>);    Console.WriteLine($<span class="hljs-string">"b:&#123;b&#125;"</span>);    Console.ReadKey();&#125;</code></pre></div><p>控制台输出结果:</p><div class="hljs"><pre><code class="hljs bash">a:123b:123a:123b:456</code></pre></div><h5 id="微软官方文档给出的解释"><a href="#微软官方文档给出的解释" class="headerlink" title="微软官方文档给出的解释"></a><a href="https://docs.microsoft.com/zh-cn/dotnet/csharp/language-reference/builtin-types/reference-types" target="_blank" rel="noopener">微软官方文档给出的解释</a></h5><p>&nbsp;&nbsp;&nbsp;&nbsp;字符串是不可变的 ，即：字符串对象在创建后，尽管从语法上看似乎可以更改其内容，但事实上并不可行。 例如，在上述代码b = “456”中，编译器实际上会创建一个新的字符串对象来保存新的字符序列，且该新对象将赋给 b。 已为 b 分配的内存可用于垃圾回收。</p>]]></content>
    
    
    <categories>
      
      <category>C#</category>
      
    </categories>
    
    
    <tags>
      
      <tag>值类型</tag>
      
      <tag>引用类型</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>v2Ray带伪装脚本</title>
    <link href="/2020/09/11/20200911/"/>
    <url>/2020/09/11/20200911/</url>
    
    <content type="html"><![CDATA[<p>此脚本支持在服务端安装基于Nginx+websocket+tls的v2ray流量伪装和bbr加速模块.</p><h3 id="注意：这是自行搭建科学上网环境的必要条件："><a href="#注意：这是自行搭建科学上网环境的必要条件：" class="headerlink" title="注意：这是自行搭建科学上网环境的必要条件："></a>注意：这是自行搭建科学上网环境的必要条件：</h3><ol><li>购买服务器和域名.</li><li>使用putty等SSH工具连接到服务器.</li><li>服务器防火墙将443、80端口放行.</li></ol><p>伪装的前提是需要一个域名（例如test.com），并且域名的某个主机名（例如aaa.test.com）正确解析到服务器的ip</p><h3 id="使用教程"><a href="#使用教程" class="headerlink" title="使用教程"></a>使用教程</h3><p>登录到服务器在终端输入如下命令：</p><div class="hljs"><pre><code class="hljs bash">bash &lt;(curl -sL https://raw.githubusercontent.com/hijkpw/scripts/master/centos_install_v2ray2.sh)</code></pre></div><p>回车开始安装，直到屏幕出现“确认满足按y，按其他退出脚本：”，确认条件满足，按y，回车，然后输入你域名的主机名（注意是主机名，比如aaa.test.com，不建议填裸域名test.com），设置一个伪装路径（不能是/），例如/test（强烈建议设置一个复杂的、别人猜不到的路径，除 “数字、字母、/、-、_” 外不能有其他特殊字符）</p><h3 id="如何判断服务端已经正常运行"><a href="#如何判断服务端已经正常运行" class="headerlink" title="如何判断服务端已经正常运行"></a>如何判断服务端已经正常运行</h3><ol><li>脚本执行完毕后终端界面上显示以下内容</li></ol><div class="hljs"><pre><code class="hljs bash">============================================ v2ray运行状态：正在运行 v2ray配置文件：/etc/v2ray/config.json nginx运行状态：正在运行 nginx配置文件：/etc/nginx/conf.d/aaa.test.com.confv2ray配置信息：IP(address):  151.123.234.456端口(port)：443id(uuid)：18950ada13-2543-235f-t235-123fds564sdf1额外id(alterid)： 0加密方式(security)： auto传输协议(network)： ws主机名(host)：aaa.test.com路径(path)：/<span class="hljs-built_in">test</span>安全传输(security)：TLSvmess链接: vmess://alkdjwqlsajbdkajhsdoqwieuw8q9ytq809uewq9ghfjksdbciaslhdo0qwiuehjqwpoihtrq[owieuqwoptyhqep90e8u1028yu34odhasjkdbzxkjlcbsau9opeyh81902y31028y512378dghashjkldgb97q81tyralsuhgf9qwgtq9wpuhdaskjb9wryqwe123=</code></pre></div><ol start="2"><li>浏览器输入域名aaa.test.com，打开是一个随机小说网站</li><li>输入域名aaa.test.com加伪装路径/test，出现”bad request”</li></ol><h3 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h3><ol><li>查看v2ray运行状态/配置：<div class="hljs"><pre><code class="hljs bash">bash &lt;(curl -sL https://raw.githubusercontent.com/hijkpw/scripts/master/centos_install_v2ray2.sh) info</code></pre></div></li><li>v2ray管理命令：<div class="hljs"><pre><code class="hljs bash">systemctl start v2ray  <span class="hljs-comment">#启动</span>systemctl stop v2ray  <span class="hljs-comment">#停止</span>systemctl restart v2ray <span class="hljs-comment">#重启</span></code></pre></div></li><li>nginx管理命令:<div class="hljs"><pre><code class="hljs bash">nginx -t<span class="hljs-comment">#测试配置文件有无错误</span>systemctl start nginx <span class="hljs-comment">#启动</span>systemctl stop nginx<span class="hljs-comment">#停止</span>systemctl restart nginx<span class="hljs-comment">#重启</span></code></pre></div></li><li>更新v2ray到最新版：<div class="hljs"><pre><code class="hljs bash">bash &lt;(curl -L -s https://install.direct/go.sh)</code></pre></div></li><li>查看SSL证书(证书有期限,到期需要更新):<div class="hljs"><pre><code class="hljs bash">certbot certificates <span class="hljs-comment">#查看SSL证书</span><span class="hljs-comment">#更新证书</span>systemctl stop nginx;certbot renew;systemctl start nginx</code></pre></div></li><li>卸载:<div class="hljs"><pre><code class="hljs bash">bash &lt;(curl -sL https://raw.githubusercontent.com/hijkpw/scripts/master/centos_install_v2ray2.sh) uninstall</code></pre></div></li></ol>]]></content>
    
    
    
    <tags>
      
      <tag>V2Ray</tag>
      
      <tag>CentOS</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>2020年7月3日21点36分</title>
    <link href="/2020/07/03/20200703/"/>
    <url>/2020/07/03/20200703/</url>
    
    <content type="html"><![CDATA[<h2 id="2020年8月3日"><a href="#2020年8月3日" class="headerlink" title="2020年8月3日"></a>2020年8月3日</h2><h5 id="距离创建这篇帖子也就是我们在一起的时间已有整整一个月-趁今天没那么忙-想着也算是一个特殊的日子写下一些值得纪念的内容。"><a href="#距离创建这篇帖子也就是我们在一起的时间已有整整一个月-趁今天没那么忙-想着也算是一个特殊的日子写下一些值得纪念的内容。" class="headerlink" title="距离创建这篇帖子也就是我们在一起的时间已有整整一个月,趁今天没那么忙,想着也算是一个特殊的日子写下一些值得纪念的内容。"></a>距离创建这篇帖子也就是我们在一起的时间已有整整一个月,趁今天没那么忙,想着也算是一个特殊的日子写下一些值得纪念的内容。</h5><h5 id="nbsp-nbsp-nbsp-nbsp-一个月的时间里总是能听到你说我话不多-和你聊着聊着也能走神-就像表现得对你没那么上心-我也确实意识到了自己在这方面有些时候令你不快-也许和我从事的职业有关吧-平时的工作模式让我想的多说的少-兴许在我没有意识到的情况下这种工作模式已经渐渐的渗透到了我的生活方式当中-如果话题突然带偏到工作方面我想我应该会滔滔不绝的吧haha。写这些也并不是代表我想逃避问题-既然有问题那就去解决纠正-将更好的自己呈现在你面前这是我所期望的。"><a href="#nbsp-nbsp-nbsp-nbsp-一个月的时间里总是能听到你说我话不多-和你聊着聊着也能走神-就像表现得对你没那么上心-我也确实意识到了自己在这方面有些时候令你不快-也许和我从事的职业有关吧-平时的工作模式让我想的多说的少-兴许在我没有意识到的情况下这种工作模式已经渐渐的渗透到了我的生活方式当中-如果话题突然带偏到工作方面我想我应该会滔滔不绝的吧haha。写这些也并不是代表我想逃避问题-既然有问题那就去解决纠正-将更好的自己呈现在你面前这是我所期望的。" class="headerlink" title="&nbsp;&nbsp;&nbsp;&nbsp;一个月的时间里总是能听到你说我话不多,和你聊着聊着也能走神,就像表现得对你没那么上心,我也确实意识到了自己在这方面有些时候令你不快,也许和我从事的职业有关吧,平时的工作模式让我想的多说的少,兴许在我没有意识到的情况下这种工作模式已经渐渐的渗透到了我的生活方式当中,如果话题突然带偏到工作方面我想我应该会滔滔不绝的吧haha。写这些也并不是代表我想逃避问题,既然有问题那就去解决纠正,将更好的自己呈现在你面前这是我所期望的。"></a>&nbsp;&nbsp;&nbsp;&nbsp;一个月的时间里总是能听到你说我话不多,和你聊着聊着也能走神,就像表现得对你没那么上心,我也确实意识到了自己在这方面有些时候令你不快,也许和我从事的职业有关吧,平时的工作模式让我想的多说的少,兴许在我没有意识到的情况下这种工作模式已经渐渐的渗透到了我的生活方式当中,如果话题突然带偏到工作方面我想我应该会滔滔不绝的吧haha。写这些也并不是代表我想逃避问题,既然有问题那就去解决纠正,将更好的自己呈现在你面前这是我所期望的。</h5><h5 id="nbsp-nbsp-nbsp-nbsp-也说说你吧。”你很好”-其实这三个字就能概括你在我心目中的印象-但是哪天看到这里的你肯定不会满意的吧哈哈-活泼可爱-大方不随便-好像我喜欢的每一种特点都会出现在你身上一样-前些天晚上你训妹妹和一个认识没几天的异性夜不归宿时说的内容让我认识到你不是一个随便的女孩子-当然在这之前我也并没有认为你是-求生欲让我觉得有必要加上这一句-我很喜欢你这一点。但是你也有让我不喜欢的缺点-你把自己的身体健康放在了一个很低的位置上-就是这一点让我今天早上还生了一把闷气-我不想因为我因为这种事情生气而导致你不开心所以没有表现在你面前-所以看到这里的话还请低血糖的你好好吃饭"><a href="#nbsp-nbsp-nbsp-nbsp-也说说你吧。”你很好”-其实这三个字就能概括你在我心目中的印象-但是哪天看到这里的你肯定不会满意的吧哈哈-活泼可爱-大方不随便-好像我喜欢的每一种特点都会出现在你身上一样-前些天晚上你训妹妹和一个认识没几天的异性夜不归宿时说的内容让我认识到你不是一个随便的女孩子-当然在这之前我也并没有认为你是-求生欲让我觉得有必要加上这一句-我很喜欢你这一点。但是你也有让我不喜欢的缺点-你把自己的身体健康放在了一个很低的位置上-就是这一点让我今天早上还生了一把闷气-我不想因为我因为这种事情生气而导致你不开心所以没有表现在你面前-所以看到这里的话还请低血糖的你好好吃饭" class="headerlink" title="&nbsp;&nbsp;&nbsp;&nbsp;也说说你吧。”你很好”,其实这三个字就能概括你在我心目中的印象,但是哪天看到这里的你肯定不会满意的吧哈哈,活泼可爱,大方不随便,好像我喜欢的每一种特点都会出现在你身上一样,前些天晚上你训妹妹和一个认识没几天的异性夜不归宿时说的内容让我认识到你不是一个随便的女孩子,当然在这之前我也并没有认为你是!(求生欲让我觉得有必要加上这一句),我很喜欢你这一点。但是你也有让我不喜欢的缺点,你把自己的身体健康放在了一个很低的位置上,就是这一点让我今天早上还生了一把闷气,我不想因为我因为这种事情生气而导致你不开心所以没有表现在你面前,所以看到这里的话还请低血糖的你好好吃饭!"></a>&nbsp;&nbsp;&nbsp;&nbsp;也说说你吧。”你很好”,其实这三个字就能概括你在我心目中的印象,但是哪天看到这里的你肯定不会满意的吧哈哈,活泼可爱,大方不随便,好像我喜欢的每一种特点都会出现在你身上一样,前些天晚上你训妹妹和一个认识没几天的异性夜不归宿时说的内容让我认识到你不是一个随便的女孩子,当然在这之前我也并没有认为你是!(求生欲让我觉得有必要加上这一句),我很喜欢你这一点。但是你也有让我不喜欢的缺点,你把自己的身体健康放在了一个很低的位置上,就是这一点让我今天早上还生了一把闷气,我不想因为我因为这种事情生气而导致你不开心所以没有表现在你面前,所以看到这里的话还请低血糖的你好好吃饭!</h5><h5 id="就先写到这里吧-总觉得界面排版加上几张照片会更好看-疯狂暗示-。"><a href="#就先写到这里吧-总觉得界面排版加上几张照片会更好看-疯狂暗示-。" class="headerlink" title="就先写到这里吧,总觉得界面排版加上几张照片会更好看(疯狂暗示)。"></a>就先写到这里吧,总觉得界面排版加上几张照片会更好看(疯狂暗示)。</h5><h5 id="马上下班就能见到你了-开心"><a href="#马上下班就能见到你了-开心" class="headerlink" title="马上下班就能见到你了,开心!"></a>马上下班就能见到你了,开心!</h5><h2 id="2020年8月11日"><a href="#2020年8月11日" class="headerlink" title="2020年8月11日"></a>2020年8月11日</h2><h5 id="nbsp-nbsp-nbsp-nbsp-突然今天就想更新了-趁午休时间写写-兴许是因为最近咱俩的沟通频率减少-兴许是被你昨晚迷迷糊糊的语气又给可爱到-反正就是我想你了你得知道！不过讲真-不管是第多少次什么时候听到你那种睡的迷迷糊糊时说话的语气都会联想到半眯着眼睛蜷缩在沙发上-嘴里嘟囔着发出呼噜呼噜声的猫-可爱到就想抱在怀里给你撸秃噜皮儿"><a href="#nbsp-nbsp-nbsp-nbsp-突然今天就想更新了-趁午休时间写写-兴许是因为最近咱俩的沟通频率减少-兴许是被你昨晚迷迷糊糊的语气又给可爱到-反正就是我想你了你得知道！不过讲真-不管是第多少次什么时候听到你那种睡的迷迷糊糊时说话的语气都会联想到半眯着眼睛蜷缩在沙发上-嘴里嘟囔着发出呼噜呼噜声的猫-可爱到就想抱在怀里给你撸秃噜皮儿" class="headerlink" title="&nbsp;&nbsp;&nbsp;&nbsp;突然今天就想更新了,趁午休时间写写,兴许是因为最近咱俩的沟通频率减少,兴许是被你昨晚迷迷糊糊的语气又给可爱到,反正就是我想你了你得知道！不过讲真,不管是第多少次什么时候听到你那种睡的迷迷糊糊时说话的语气都会联想到半眯着眼睛蜷缩在沙发上,嘴里嘟囔着发出呼噜呼噜声的猫,可爱到就想抱在怀里给你撸秃噜皮儿!"></a>&nbsp;&nbsp;&nbsp;&nbsp;突然今天就想更新了,趁午休时间写写,兴许是因为最近咱俩的沟通频率减少,兴许是被你昨晚迷迷糊糊的语气又给可爱到,反正就是我想你了你得知道！不过讲真,不管是第多少次什么时候听到你那种睡的迷迷糊糊时说话的语气都会联想到半眯着眼睛蜷缩在沙发上,嘴里嘟囔着发出呼噜呼噜声的猫,可爱到就想抱在怀里给你撸秃噜皮儿!</h5><h5 id="nbsp-nbsp-nbsp-nbsp-最近我也多了个爱好-时不时的喜欢盯着你看-这个时候你大抵会扭过头去-嘴里冒出一句-”你看我干嘛-”-有时我就那么笑着看你-更多时候我也会回你一句-”还不让我看啦-”期待有一天目光对视时你我不再闪躲-不过真有这么一回的话我想也会以笑场收尾吧哈哈。"><a href="#nbsp-nbsp-nbsp-nbsp-最近我也多了个爱好-时不时的喜欢盯着你看-这个时候你大抵会扭过头去-嘴里冒出一句-”你看我干嘛-”-有时我就那么笑着看你-更多时候我也会回你一句-”还不让我看啦-”期待有一天目光对视时你我不再闪躲-不过真有这么一回的话我想也会以笑场收尾吧哈哈。" class="headerlink" title="&nbsp;&nbsp;&nbsp;&nbsp;最近我也多了个爱好,时不时的喜欢盯着你看,这个时候你大抵会扭过头去,嘴里冒出一句:”你看我干嘛?”,有时我就那么笑着看你,更多时候我也会回你一句:”还不让我看啦?”期待有一天目光对视时你我不再闪躲,不过真有这么一回的话我想也会以笑场收尾吧哈哈。"></a>&nbsp;&nbsp;&nbsp;&nbsp;最近我也多了个爱好,时不时的喜欢盯着你看,这个时候你大抵会扭过头去,嘴里冒出一句:”你看我干嘛?”,有时我就那么笑着看你,更多时候我也会回你一句:”还不让我看啦?”期待有一天目光对视时你我不再闪躲,不过真有这么一回的话我想也会以笑场收尾吧哈哈。</h5><h5 id="今天休假的你这会告诉我睡醒了-没来由的觉得很温馨。"><a href="#今天休假的你这会告诉我睡醒了-没来由的觉得很温馨。" class="headerlink" title="今天休假的你这会告诉我睡醒了,没来由的觉得很温馨。"></a>今天休假的你这会告诉我睡醒了,没来由的觉得很温馨。</h5><h5 id="就写这么多-午休时间还剩一点我也眯会儿。"><a href="#就写这么多-午休时间还剩一点我也眯会儿。" class="headerlink" title="就写这么多,午休时间还剩一点我也眯会儿。"></a>就写这么多,午休时间还剩一点我也眯会儿。</h5><h2 id="2020年8月16日"><a href="#2020年8月16日" class="headerlink" title="2020年8月16日"></a>2020年8月16日</h2><h5 id="nbsp-nbsp-nbsp-nbsp-最近两次争吵的源头都是我将事情想的复杂，明明可以避免的矛盾由于我的胡思乱想以及不表达将一件再简单不过的日常对话放大演变成争执，长久以来内心里有个声音告诉我：“别人表现在你面前的并不一定就是他真正想让你看到的”，说出这句话的主人在将你慢慢推离我的身边。但我意识到你表现在我面前的就是你想让我看到的，你并不在那句话的“别人”那一类人之中，你将是以后漫长的半个多世纪里陪我一起度过的人，我想要和你一起走下去，我想要改变，一定会改变，为了不让你我以后的相处方式变得小心翼翼如屡薄冰。"><a href="#nbsp-nbsp-nbsp-nbsp-最近两次争吵的源头都是我将事情想的复杂，明明可以避免的矛盾由于我的胡思乱想以及不表达将一件再简单不过的日常对话放大演变成争执，长久以来内心里有个声音告诉我：“别人表现在你面前的并不一定就是他真正想让你看到的”，说出这句话的主人在将你慢慢推离我的身边。但我意识到你表现在我面前的就是你想让我看到的，你并不在那句话的“别人”那一类人之中，你将是以后漫长的半个多世纪里陪我一起度过的人，我想要和你一起走下去，我想要改变，一定会改变，为了不让你我以后的相处方式变得小心翼翼如屡薄冰。" class="headerlink" title="&nbsp;&nbsp;&nbsp;&nbsp;最近两次争吵的源头都是我将事情想的复杂，明明可以避免的矛盾由于我的胡思乱想以及不表达将一件再简单不过的日常对话放大演变成争执，长久以来内心里有个声音告诉我：“别人表现在你面前的并不一定就是他真正想让你看到的”，说出这句话的主人在将你慢慢推离我的身边。但我意识到你表现在我面前的就是你想让我看到的，你并不在那句话的“别人”那一类人之中，你将是以后漫长的半个多世纪里陪我一起度过的人，我想要和你一起走下去，我想要改变，一定会改变，为了不让你我以后的相处方式变得小心翼翼如屡薄冰。"></a>&nbsp;&nbsp;&nbsp;&nbsp;最近两次争吵的源头都是我将事情想的复杂，明明可以避免的矛盾由于我的胡思乱想以及不表达将一件再简单不过的日常对话放大演变成争执，长久以来内心里有个声音告诉我：“别人表现在你面前的并不一定就是他真正想让你看到的”，说出这句话的主人在将你慢慢推离我的身边。但我意识到你表现在我面前的就是你想让我看到的，你并不在那句话的“别人”那一类人之中，你将是以后漫长的半个多世纪里陪我一起度过的人，我想要和你一起走下去，我想要改变，一定会改变，为了不让你我以后的相处方式变得小心翼翼如屡薄冰。</h5><h5 id="这次更新对我来说检讨的作用大于记录的作用，提醒自己和你相处时的方式简单点，思想简单点，珍惜眼前人。"><a href="#这次更新对我来说检讨的作用大于记录的作用，提醒自己和你相处时的方式简单点，思想简单点，珍惜眼前人。" class="headerlink" title="这次更新对我来说检讨的作用大于记录的作用，提醒自己和你相处时的方式简单点，思想简单点，珍惜眼前人。"></a>这次更新对我来说检讨的作用大于记录的作用，提醒自己和你相处时的方式简单点，思想简单点，珍惜眼前人。</h5><h5 id="亲爱的李可爱，晚安"><a href="#亲爱的李可爱，晚安" class="headerlink" title="亲爱的李可爱，晚安~"></a>亲爱的李可爱，晚安~</h5>]]></content>
    
    
    <categories>
      
      <category>Life</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>转换HTML内容为Bitmap</title>
    <link href="/2020/06/16/20200616/"/>
    <url>/2020/06/16/20200616/</url>
    
    <content type="html"><![CDATA[<h2 id="利用COM组件将HTML内容转换为Bitmap"><a href="#利用COM组件将HTML内容转换为Bitmap" class="headerlink" title="利用COM组件将HTML内容转换为Bitmap"></a>利用COM组件将HTML内容转换为Bitmap</h2><h3 id="画图"><a href="#画图" class="headerlink" title="画图"></a>画图</h3><p>其中html内容为一个公网链接或者本地虚拟路径</p><div class="hljs"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Bitmap <span class="hljs-title">ConverHTML</span><span class="hljs-params">(string htmPath)</span></span><span class="hljs-function"></span>&#123;    string ImagePath = string.Empty;    WebBrowser web = <span class="hljs-keyword">new</span> WebBrowser();    web.Navigate(htmPath);    <span class="hljs-keyword">while</span> (web.ReadyState != WebBrowserReadyState.Complete)    &#123;        Application.DoEvents();    &#125;    <span class="hljs-comment">//矩形容器宽高</span>    Rectangle screen = Screen.PrimaryScreen.Bounds;    screen.Width = (<span class="hljs-keyword">int</span>)(screen.Width * <span class="hljs-number">0.55</span>);  <span class="hljs-comment">//自定义55%宽</span>    screen.Height = (<span class="hljs-keyword">int</span>)(screen.Height * <span class="hljs-number">0.3</span>); <span class="hljs-comment">//30%高</span>    Size? imgsize = <span class="hljs-keyword">null</span>;    <span class="hljs-comment">//设置宽高</span>    web.Width = screen.Width;    web.Height = screen.Height;    web.ScriptErrorsSuppressed = <span class="hljs-keyword">true</span>;    web.ScrollBarsEnabled = <span class="hljs-keyword">false</span>;    Rectangle body = web.Document.Body.ScrollRectangle;    Rectangle docRectangle = <span class="hljs-keyword">new</span> Rectangle()    &#123;        Location = <span class="hljs-keyword">new</span> Point(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>),        Size = <span class="hljs-keyword">new</span> Size(body.Width &gt; screen.Width ? body.Width : screen.Width,         body.Height &gt; screen.Height ? body.Height : screen.Height)    &#125;;    Rectangle imgRectangle;    <span class="hljs-keyword">if</span> (imgsize == <span class="hljs-keyword">null</span>)        imgRectangle = docRectangle;    <span class="hljs-keyword">else</span>        imgRectangle = <span class="hljs-keyword">new</span> Rectangle()        &#123;            Location = <span class="hljs-keyword">new</span> Point(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>),            Size = imgsize.Value        &#125;;    Bitmap bitmap = <span class="hljs-keyword">new</span> Bitmap(web.Width, web.Height);    IViewObject ivo = web.Document.DomDocument as IViewObject;    using (Graphics g = Graphics.FromImage(bitmap))    &#123;        IntPtr hdc = g.GetHdc();        ivo.Draw(<span class="hljs-number">1</span>, -<span class="hljs-number">1</span>, IntPtr.Zero, IntPtr.Zero,                 IntPtr.Zero, hdc, ref imgRectangle,                 ref docRectangle, IntPtr.Zero, <span class="hljs-number">0</span>);        g.ReleaseHdc(hdc);    &#125;    <span class="hljs-keyword">return</span> bitmap;&#125;</code></pre></div><h3 id="com组件用来实例化操作系统窗体"><a href="#com组件用来实例化操作系统窗体" class="headerlink" title="com组件用来实例化操作系统窗体"></a>com组件用来实例化操作系统窗体</h3><div class="hljs"><pre><code class="hljs java">[ComVisible(<span class="hljs-keyword">true</span>), ComImport()][GuidAttribute(<span class="hljs-string">"0000010d-0000-0000-C000-000000000046"</span>)][InterfaceTypeAttribute(ComInterfaceType.InterfaceIsIUnknown)]<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">IViewObject</span></span><span class="hljs-class"></span>&#123;[<span class="hljs-keyword">return</span>: MarshalAs(UnmanagedType.I4)]        [PreserveSig]        <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">Draw</span><span class="hljs-params">(</span></span><span class="hljs-function"><span class="hljs-params">            [MarshalAs(UnmanagedType.U4)</span>] UInt32 dwDrawAspect,</span><span class="hljs-function">            <span class="hljs-keyword">int</span> lindex,</span><span class="hljs-function">            IntPtr pvAspect,</span><span class="hljs-function">            [In] IntPtr ptd,</span><span class="hljs-function">            IntPtr hdcTargetDev,</span><span class="hljs-function">            IntPtr hdcDraw,</span><span class="hljs-function">            [<span class="hljs-title">MarshalAs</span><span class="hljs-params">(UnmanagedType.Struct)</span>] ref Rectangle lprcBounds,</span><span class="hljs-function">            [<span class="hljs-title">MarshalAs</span><span class="hljs-params">(UnmanagedType.Struct)</span>] ref Rectangle lprcWBounds,</span><span class="hljs-function">            IntPtr pfnContinue,</span><span class="hljs-function">            [<span class="hljs-title">MarshalAs</span><span class="hljs-params">(UnmanagedType.U4)</span>] UInt32 dwContinue)</span>;&#125;</code></pre></div>]]></content>
    
    
    <categories>
      
      <category>C#</category>
      
    </categories>
    
    
    <tags>
      
      <tag>COM</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
